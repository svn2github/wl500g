--- miniupnpd.orig/genconfig.sh	2011-03-09 15:31:00.000000000 +0000
+++ miniupnpd/genconfig.sh	2011-05-20 11:12:08.672521000 +0000
@@ -34,12 +34,17 @@ if [ -f ./os.openwrt ]; then
 	OS_VERSION=$(cat ./os.openwrt)
 fi
 
+# WL500g project special case
+if [ -f ../../gateway/Makefile ]; then
+	OS_NAME=WL500g
+fi
+
 ${RM} ${CONFIGFILE}
 
 echo "/* MiniUPnP Project" >> ${CONFIGFILE}
 echo " * http://miniupnp.free.fr/ or http://miniupnp.tuxfamily.org/" >> ${CONFIGFILE}
 echo " * (c) 2006-2011 Thomas Bernard" >> ${CONFIGFILE}
-echo " * generated by $0 on `date` */" >> ${CONFIGFILE}
+echo " * generated by $0 on `LC_ALL=C date -u` */" >> ${CONFIGFILE}
 echo "#ifndef $CONFIGMACRO" >> ${CONFIGFILE}
 echo "#define $CONFIGMACRO" >> ${CONFIGFILE}
 echo "" >> ${CONFIGFILE}
@@ -187,6 +192,13 @@ case $OS_NAME in
 		echo "#define USE_NETFILTER 1" >> ${CONFIGFILE}
 		FW=netfilter
 		;;
+	WL500g)
+		OS_VERSION=`cat ../Makefile | awk -F= '/RELEASE=/{print $2}'`
+		[ -f ../.svnrev ] && OS_VERSION="${OS_VERSION}-$(cat ../.svnrev)"
+		OS_URL=http://wl500g.googlecode.com/
+		echo "#define USE_NETFILTER 1" >> ${CONFIGFILE}
+		FW=netfilter
+		;;
 	Darwin)
 		echo "#define USE_IPFW 1" >> ${CONFIGFILE}
 		FW=ipfw
@@ -245,7 +257,7 @@ echo "#define USE_DAEMON" >> ${CONFIGFIL
 echo "" >> ${CONFIGFILE}
 
 echo "/* Uncomment the following line to enable lease file support */" >> ${CONFIGFILE}
-echo "/*#define ENABLE_LEASEFILE*/" >> ${CONFIGFILE}
+echo "#define ENABLE_LEASEFILE" >> ${CONFIGFILE}
 echo "" >> ${CONFIGFILE}
 
 echo "/* Define one or none of the two following macros in order to make some" >> ${CONFIGFILE}
@@ -297,7 +307,7 @@ echo "#define ENABLE_L3F_SERVICE" >> ${C
 echo "" >> ${CONFIGFILE}
 
 echo "/* include interface name in pf and ipf rules */" >> ${CONFIGFILE}
-echo "#define USE_IFNAME_IN_RULES" >> ${CONFIGFILE}
+echo "/*#define USE_IFNAME_IN_RULES*/" >> ${CONFIGFILE}
 echo "" >> ${CONFIGFILE}
 
 echo "/* Experimental NFQUEUE support. */" >> ${CONFIGFILE}
--- miniupnpd.orig/upnpdescstrings.h	2007-02-09 10:13:21.000000000 +0000
+++ miniupnpd/upnpdescstrings.h	2011-05-20 13:38:03.482521000 +0000
@@ -10,11 +10,11 @@
 #include "config.h"
 
 /* strings used in the root device xml description */
-/*#define ROOTDEV_FRIENDLYNAME		OS_NAME " router"*/
-#define ROOTDEV_MANUFACTURER		OS_NAME
-#define ROOTDEV_MANUFACTURERURL		OS_URL
-#define ROOTDEV_MODELNAME			OS_NAME " router"
-#define ROOTDEV_MODELDESCRIPTION	OS_NAME " router"
+#define ROOTDEV_FRIENDLYNAME		"ASUS Wireless Router"
+#define ROOTDEV_MANUFACTURER		"ASUSTek"
+#define ROOTDEV_MANUFACTURERURL		"http://www.asus.com/"
+#define ROOTDEV_MODELNAME		"Wireless Router"
+#define ROOTDEV_MODELDESCRIPTION	OS_NAME " Router"
 #define ROOTDEV_MODELURL			OS_URL
 
 #define WANDEV_FRIENDLYNAME			"WANDevice"
--- a/upnpglobalvars.c
+++ b/upnpglobalvars.c
@@ -76,8 +76,8 @@ const char * tag = 0;
 #ifdef USE_NETFILTER
 /* chain name to use, both in the nat table
  * and the filter table */
-const char * miniupnpd_nat_chain = "MINIUPNPD";
-const char * miniupnpd_forward_chain = "MINIUPNPD";
+const char * miniupnpd_nat_chain = "UPNP";
+const char * miniupnpd_forward_chain = "UPNP";
 #endif
 #ifdef ENABLE_NFQUEUE
 int nfqueue = -1;
