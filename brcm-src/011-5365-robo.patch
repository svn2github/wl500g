--- src/shared/bcmrobo.c.orig	2007-10-16 00:17:58.457531336 +0400
+++ src/shared/bcmrobo.c	2007-10-16 00:22:10.053282968 +0400
@@ -74,7 +74,9 @@
 #define REG_VLAN_CTRL4	0x04	/* VLAN Control 4 register */
 #define REG_VLAN_CTRL5	0x05	/* VLAN Control 5 register */
 #define REG_VLAN_ACCESS	0x06	/* VLAN Table Access register */
+#define REG_VLAN_ACCESS_5365	0x08	/* 5365 VLAN Table Access register */
 #define REG_VLAN_WRITE	0x08	/* VLAN Write register */
+#define REG_VLAN_WRITE_5365	0x0A	/* 5365 VLAN Write register */
 #define REG_VLAN_READ	0x0C	/* VLAN Read register */
 #define REG_VLAN_PTAG0	0x10	/* VLAN Default Port Tag register - port 0 */
 #define REG_VLAN_PTAG1	0x12	/* VLAN Default Port Tag register - port 1 */
@@ -968,7 +970,21 @@
 
 		val32 = (untag |			/* untag enable */
 		         member);			/* vlan members */
-		if (robo->devid == DEVID5325) {
+		if (sb_chip(robo->sbh) == BCM5365_CHIP_ID) 
+		{
+			/* VLAN Write Register (Page 0x34, Address 0x0A) */
+			val32 = ((1 << 14) |	/* valid write */
+				 (untag << 1) |	/* untag enable */
+				 member);		/* vlan members */
+			robo->ops->write_reg(robo, PAGE_VLAN, REG_VLAN_WRITE_5365, &val32,
+			                     sizeof(val32));
+			/* VLAN Table Access Register (Page 0x34, Address 0x08) */
+			val16 = ((1 << 13) | 	/* start command */
+				 (1 << 12) |	/* write state */
+				 vid);		/* vlan id */
+			robo->ops->write_reg(robo, PAGE_VLAN, REG_VLAN_ACCESS_5365, &val16,
+			                     sizeof(val16));
+		} else if (robo->devid == DEVID5325) {
 			val32 |= ((1 << 20) |		/* valid write */
 			          ((vid >> 4) << 12));	/* vlan id bit[11:4] */
 			/* VLAN Write Register (Page 0x34, Address 0x08-0x0B) */
@@ -1058,6 +1074,10 @@
 	    }
 	}
 
+	/* Enable WAN port (#0) on the asus wl-500g deluxe boxes */
+	val8 = 0;
+	robo->ops->write_reg(robo, PAGE_CTRL, REG_CTRL_PORT0, &val8, sizeof(val8));
+
 	/* Disable management interface access */
 	if (robo->ops->disable_mgmtif)
 		robo->ops->disable_mgmtif(robo);
